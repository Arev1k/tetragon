class CartManager{constructor(){this.items=[],this.total=0,this.init()}init(){this.loadFromStorage(),this.updateCartDisplay(),this.setupEventListeners()}loadFromStorage(){try{const t=localStorage.getItem("techstore_cart");if(t){const e=JSON.parse(t);this.items=e.items||[],this.calculateTotal()}}catch(t){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage:",t),this.items=[]}}saveToStorage(){try{const t={items:this.items,total:this.total,timestamp:(new Date).toISOString()};localStorage.setItem("techstore_cart",JSON.stringify(t))}catch(t){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã –≤ localStorage:",t)}}addItem(t){if(!this.validateProduct(t))return console.error("–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–≤–∞—Ä:",t),!1;try{const e=this.items.find((e=>e.id===t.id));return e?e.quantity+=1:this.items.push({...t,quantity:1}),this.calculateTotal(),this.updateCartDisplay(),this.saveToStorage(),!0}catch(t){return console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É:",t),!1}}removeItem(t){try{return this.items=this.items.filter((e=>e.id!==t)),this.calculateTotal(),this.updateCartDisplay(),this.saveToStorage(),!0}catch(t){return console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã:",t),!1}}updateQuantity(t,e){if(e<1)return this.removeItem(t);try{const a=this.items.find((e=>e.id===t));return!!a&&(a.quantity=e,this.calculateTotal(),this.updateCartDisplay(),this.saveToStorage(),!0)}catch(t){return console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞:",t),!1}}clearCart(){this.items=[],this.total=0,this.updateCartDisplay(),this.saveToStorage()}calculateTotal(){this.total=this.items.reduce(((t,e)=>t+e.price*e.quantity),0)}updateCartDisplay(){const t=document.getElementById("cartCount");if(t){const e=this.items.reduce(((t,e)=>t+e.quantity),0);t.textContent=e,t.style.display=e>0?"flex":"none"}this.updateCartModal()}updateCartModal(){const t=document.getElementById("cartItems"),e=document.getElementById("cartTotal");t&&e&&(0===this.items.length?t.innerHTML='\n                <div class="text-center" style="color: var(--text-secondary); padding: var(--spacing-xl);">\n                    –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞\n                </div>\n            ':t.innerHTML=this.items.map((t=>`\n                <div class="cart-item" data-product-id="${t.id}">\n                    <div class="cart-item__info">\n                        <div class="cart-item__name">${t.name}</div>\n                        <div class="cart-item__price">${this.formatPrice(t.price)} ‚ÇΩ √ó ${t.quantity}</div>\n                    </div>\n                    <div class="cart-item__actions">\n                        <button class="cart-item__btn" \n                                onclick="cartManager.updateQuantity(${t.id}, ${t.quantity-1})"\n                                aria-label="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">\n                            -\n                        </button>\n                        <span class="cart-item__quantity">${t.quantity}</span>\n                        <button class="cart-item__btn" \n                                onclick="cartManager.updateQuantity(${t.id}, ${t.quantity+1})"\n                                aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">\n                            +\n                        </button>\n                        <button class="cart-item__btn" \n                                onclick="cartManager.removeItem(${t.id})"\n                                aria-label="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä">\n                            üóëÔ∏è\n                        </button>\n                    </div>\n                </div>\n            `)).join(""),e.textContent=this.formatPrice(this.total))}showCart(){const t=document.getElementById("cartModal");if(t){t.style.display="block",t.setAttribute("aria-hidden","false");const e=t.querySelector(".modal__close");e&&e.focus()}}closeCart(){const t=document.getElementById("cartModal");t&&(t.style.display="none",t.setAttribute("aria-hidden","true"))}checkout(){if(0!==this.items.length)try{const t={items:this.items,total:this.total,orderId:"TS"+Date.now(),date:(new Date).toISOString()};console.log("–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:",t),alert(`–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n\n–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ${t.orderId}\n–°—É–º–º–∞: ${this.formatPrice(this.total)} ‚ÇΩ\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!`),this.clearCart(),this.closeCart()}catch(t){console.error("–û—à–∏–±–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:",t),alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")}else alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞")}validateProduct(t){return t&&"number"==typeof t.id&&"string"==typeof t.name&&"number"==typeof t.price&&t.price>0}formatPrice(t){return new Intl.NumberFormat("ru-RU").format(t)}setupEventListeners(){const t=document.querySelector(".cart-button");t&&t.addEventListener("click",(()=>this.showCart()));const e=document.querySelector(".modal__close");e&&e.addEventListener("click",(()=>this.closeCart()));const a=document.getElementById("cartModal");a&&a.addEventListener("click",(t=>{t.target===a&&this.closeCart()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&this.closeCart()}))}}function closeCart(){window.cartManager&&window.cartManager.closeCart()}function checkout(){window.cartManager&&window.cartManager.checkout()}document.addEventListener("DOMContentLoaded",(()=>{window.cartManager=new CartManager}));