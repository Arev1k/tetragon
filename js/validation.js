class FormValidator{constructor(){this.init()}init(){this.setupContactForm(),this.setupGlobalErrorHandling()}setupContactForm(){const e=document.getElementById("contactForm");e?(e.addEventListener("submit",(t=>{t.preventDefault(),this.validateContactForm(e)})),this.setupRealTimeValidation(e)):console.warn("Форма контактов не найдена")}async validateContactForm(e){const t=new FormData(e),r=Object.fromEntries(t.entries());try{this.clearErrors(e);const t=this.validateFormData(r);if(Object.keys(t).length>0)return void this.displayErrors(t);this.setFormLoading(e,!0),await this.submitFormData(r),this.showFormSuccess(e)}catch(e){console.error("Ошибка отправки формы:",e),this.showFormError("Произошла ошибка при отправке формы. Пожалуйста, попробуйте еще раз.")}finally{this.setFormLoading(e,!1)}}validateFormData(e){const t={};return e.name&&0!==e.name.trim().length?e.name.trim().length<2?t.name="Имя должно содержать минимум 2 символа":/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(e.name)||(t.name="Имя может содержать только буквы, пробелы и дефисы"):t.name="Имя обязательно для заполнения",e.email&&0!==e.email.trim().length?this.isValidEmail(e.email)||(t.email="Введите корректный email адрес"):t.email="Email обязателен для заполнения",e.message&&e.message.length>1e3&&(t.message="Сообщение не должно превышать 1000 символов"),t}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}displayErrors(e){Object.keys(e).forEach((t=>{const r=document.getElementById(t),o=document.getElementById(t+"Error");r&&o&&(r.classList.add("error"),o.textContent=e[t],o.setAttribute("role","alert"),document.querySelector(".error:focus")||r.focus())}))}clearErrors(e){const t=e.querySelectorAll(".error-message"),r=e.querySelectorAll(".form-input.error, .form-textarea.error");t.forEach((e=>{e.textContent="",e.removeAttribute("role")})),r.forEach((e=>{e.classList.remove("error")}))}setFormLoading(e,t){const r=e.querySelector('button[type="submit"]');r&&(t?(r.disabled=!0,r.textContent="Отправка...",e.classList.add("loading")):(r.disabled=!1,r.textContent="Отправить сообщение",e.classList.remove("loading")))}async submitFormData(e){return new Promise(((e,t)=>{setTimeout((()=>{Math.random()<.1?t(new Error("Server error")):e()}),2e3)}))}showFormSuccess(e){e.reset();const t=document.createElement("div");t.className="message message--success",t.textContent="Сообщение успешно отправлено! Мы свяжемся с вами в ближайшее время.",t.setAttribute("role","alert"),e.parentNode.insertBefore(t,e),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),5e3);const r=e.querySelector("input, textarea");r&&r.focus()}showFormError(e){window.productManager?window.productManager.showErrorMessage(e):alert(e)}setupRealTimeValidation(e){e.querySelectorAll("input, textarea").forEach((e=>{e.addEventListener("blur",(()=>{this.validateField(e)})),e.addEventListener("input",(()=>{const t=document.getElementById(e.name+"Error");t&&t.textContent&&(e.classList.remove("error"),t.textContent="")}))}))}validateField(e){const t=e.value.trim(),r=e.name;let o="";switch(r){case"name":t?t.length<2?o="Имя должно содержать минимум 2 символа":/^[a-zA-Zа-яА-ЯёЁ\s\-]+$/.test(t)||(o="Имя может содержать только буквы, пробелы и дефисы"):o="Имя обязательно для заполнения";break;case"email":t?this.isValidEmail(t)||(o="Введите корректный email адрес"):o="Email обязателен для заполнения";break;case"message":t.length>1e3&&(o="Сообщение не должно превышать 1000 символов")}const a=document.getElementById(r+"Error");a&&(o?(e.classList.add("error"),a.textContent=o,a.setAttribute("role","alert")):(e.classList.remove("error"),a.textContent="",a.removeAttribute("role")))}setupGlobalErrorHandling(){window.addEventListener("error",(e=>{console.error("Global validation error:",e.error)})),window.addEventListener("unhandledrejection",(e=>{console.error("Unhandled promise rejection:",e.reason)}))}static validatePhone(e){return/^[\+]?[78][-\s]?\(?\d{3}\)?[-\s]?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/.test(e.replace(/\s/g,""))}static validatePassword(e){const t={minLength:e.length>=8,hasUpperCase:/[A-Z]/.test(e),hasLowerCase:/[a-z]/.test(e),hasNumbers:/\d/.test(e),hasSpecialChar:/[!@#$%^&*(),.?":{}|<>]/.test(e)};return{isValid:Object.values(t).every(Boolean),requirements:t}}}document.addEventListener("DOMContentLoaded",(()=>{window.formValidator=new FormValidator})),"undefined"!=typeof module&&module.exports&&(module.exports=FormValidator);